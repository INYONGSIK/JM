<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ucamp.JM.dao.BoardDAO">
    <select id="boardSelectAll" resultType="Board">
        select
        dashboard_No, user_number, dashboard_title,dashboard_user,
        to_char(dashboard_date,'YYYY/MM/DD') as "dashboard_date",
        dashboard_views, dashboard_comment, dashboard_content
        from dashboard order by dashboard_No
    </select>

    <select id="getUserNicknameByEmail" resultType="User">
        select user_nickname, user_number from jmuser where user_email=#{user_email}
    </select>

    <insert id="insertBoardWrite" parameterType="Board">
        insert into dashboard
        (dashboard_No, user_number, dashboard_title, dashboard_user, dashboard_date, dashboard_views, dashboard_content)

        values (dashboard_seq.nextval, #{user_number}, #{dashboard_title}, #{dashboard_user},
        SYSDATE
        , #{dashboard_views,jdbcType=NUMERIC}, #{dashboard_content})
    </insert>

    <select id="readboard" resultType="Board">
        select * from dashboard where dashboard_No=#{dashboard_No}
    </select>

    <delete id="deletedashboard">
        delete from dashboard where dashboard_No=#{dashboard_No}
    </delete>

    <select id="boardSearchList" resultType="Board">
        select * from dashboard where dashboard_title like '%${boardSearchString}%' or dashboard_content like
        '%${boardSearchString}%' or dashboard_user like '%${boardSearchString}%' order by dashboard_No
    </select>


    <update id="editBoard" parameterType="Map">
        update dashboard set dashboard_title='${dashboard_title}',
        dashboard_content='${dashboard_content}'
        where dashboard_No=${dashboard_No}
    </update>

    <update id="updateView">
        update dashboard set dashboard_views=dashboard_views+1 where dashboard_No=#{dashboard_No}
    </update>

    <insert id="comment" parameterType="Comments">
        insert into comments
        (cno, dashboard_no, content, createat, writer)
        values (comments_seq.nextval, #{dashboard_No},#{comment}, sysdate, #{writer})
    </insert>

    <select id="CommentSelectAll" resultType="Comments">
        select
        cno, dashboard_No, content,
        to_char(createat,'YYYY/MM/DD') as "createat",
        writer
        from comments
        where dashboard_No=#{dashboard_No}
        order by cno
    </select>

    <delete id="deleteComment" parameterType="Map">
        delete from comments where dashboard_No=#{dashboard_No} and cno=#{cno}
    </delete>

    <insert id="reportComment" parameterType="Map">
        insert into report
        (user_number, report_ID,report_type,contents,report_count)
        values (${user_number},report_seq.nextval,1,'${contents}',0)
    </insert>

    <select id="getUserNumByNickname" resultType="User">
        select user_number from jmuser where user_nickname=#{user_nickname}
    </select>

    <update id="updateReport_count" parameterType="Map">
        update report set report_count=report_count+1 where user_number=#{user_number} and contents=#{contents}
    </update>
</mapper>
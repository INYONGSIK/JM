<!DOCTYPE html>
<html lang="en" xmlns:th="www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<div>
    <div class="content">
        <form action="/modifyPassword" method="get" id="form">
            <h1>비밀번호 변경</h1>
            <div>
                <input type="hidden" id="email" name="user_email" th:value="${user_email}">
                <div>
                    <label for="user_password">새 비밀번호 입력</label>
                    <input type="password" id="user_password" name="user_password" required/>
                    <div class="error"></div>
                </div>
                <div>
                    <label for="user_password2">새 비밀번호확인</label>
                    <input type="password" id="user_password2">
                    <div class="error"></div>
                </div>
                <input type="submit" value="비밀번호 변경" onClick="return check();"/>
            </div>
        </form>
    </div>
</div>

<script>
    const form = document.getElementById("form");
    const password = document.getElementById("user_password");
    const password2 = document.getElementById("user_password2");

    password.addEventListener("change", checkPassword);
    password2.addEventListener("change", checkPassword2);

    const setError = (element,message) =>{
        const inputControl = element.parentElement;
        const errorDisplay = inputControl.querySelector('.error');
        errorDisplay.innerText = message;
    }

    const setSuccess = element => {
    const inputControl = element.parentElement;
    const errorDisplay = inputControl.querySelector('.error');
    errorDisplay.innerText = '';
    }

    function checkPassword() {
    const passwordValue = password.value.trim();
    var pwPattern = /^(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/;
    if (passwordValue.value === "") {
        setError(password, "필수 정보입니다.");
        return false;
    } else if (!pwPattern.test(passwordValue)) {
        setError(password, "8~16자 영문 대 소문자, 숫자, 특수문자를 사용하세요.");
        return false;
    } else {
        setSuccess(password);
    }
    return true;
}

function checkPassword2() {
    const passwordValue = password.value.trim();
    const password2Value = password2.value.trim();
    if (password2Value === "") {
        setError(password2, "필수 정보입니다.");
        return false;
    } else if (password2Value !== passwordValue) {
        setError(password2, "비밀번호가 일치하지 않습니다.");
        return false;
    } else {
        setSuccess(password2);
    }
    return true;
}

function check(){
    checkPassword();
    checkPassword2()
    if(checkPassword() === true  && checkPassword2()===true){
        alert("비밀번호가 변경 되었습니다.")
        $("form").submit();
    }else{
        alert("비밀번호 변경에 실패했습니다.")
        return false;
    }
}


















</script>
</body>

</html>
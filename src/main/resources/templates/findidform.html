<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Nanum+Gothic&amp;display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="webapp/css/register.css"/>
</head>
<body>
<div class="wrapper">
    <div class="container" style="margin-top : 200px">
        <form>
            <h1 style="text-align:center">아이디 찾기</h1>
            <br><br>
            <table>
                <tr>
                    <td>이름</td>
                    <td><input type="text" id="user_name" name="user_name"/></td>
                </tr>
                <tr>
                    <th>
                        <label>휴대폰 번호</label>
                    </th>
                    <td>
                        <div>
                            <input class="signup_inputs user_border" id="user_phone_number" type="text"
                                   name="user_phone_number"
                                   title="전화번호 입력" style=""/>
                            <input type="button" id="phoneChk" class="w-btn" value="인증번호 받기">
                        </div>
                        <div class="error"></div>
                        <br/>
                        <div class="input-control">
                            <div style="display:flex">
                                <input class="signup_inputs user_border" id="phone2" type="text"
                                       name="phone2"
                                       title="인증번호 입력"/>
                                <input type="button" id="phoneChk2" class="w-btn" value="본인인증">
                            </div>
                            <div class="error" style="color :red"></div>
                            <span class="point successPhoneChk">휴대폰 번호 입력후 인증번호 보내기를 해주십시오.</span>
                            <input type="hidden" id="phoneDoubleChk"/>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td><input type="text" id="hideEmail" readonly/></td>
                </tr>
            </table>
        </form>
    </div>
</div>
<script>
    var code2 = "";
    $("#phoneChk").click(function(){
    var name = document.getElementById('user_name').value;
    var phone = document.getElementById('user_phone_number').value;
        $.ajax({
            type : "post",
            url :"findid",
            data : {
                "user_name" : name,
                "user_phone_number" : phone
            },
            success : function(data){
                if(data == "성공"){
                    alert("인증번호 발송이 완료되었습니다.\n휴대폰에서 인증번호 확인을 해주십시오.");
                    $.ajax({
                        type: "get",
                        url: "phoneCheck",
                        data:{
                        "user_phone_number" : phone,
                        },
                        success:function(data){
                            if(data =="error"){
                                alert("휴대폰 번호가 올바르지 않습니다.")
                            }else{
                                code2 = data;
                                console.log(code2);
                            }
                        }
                    });
                }else{
                    alert("이름과 휴대폰번호가 일치하지 않습니다.")
                }
            },
            error : function(e){
                alert("에러 발생 : " + e);
            }
        })
    })

$("#phoneChk2").click(function(){
    var name = document.getElementById('user_name').value;
    var phone = document.getElementById('user_phone_number').value;
    if($("#phone2").val() == code2 ){
        console.log(name);
        console.log(phone);
        alert("인증번호가 일치합니다.");
        $.ajax({
            type : "post",
            url : "findid2",
            data : {
                "user_name" : name,
                "user_phone_number" : phone,
            },
            success:function(data){
                $("#hideEmail").text(data.user_email);
            },
            error : function(data,e){
                console.log(data);
                alert("에러 발생 : " + e);
            }
        })
    }else{
        alert("인증번호가 일치하지 않습니다.");
    }
})


























































































</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

</head>
<body>
<div class="content">
    <form>
        <h1>아이디 찾기</h1>

        <table>
            <tr>
                <td>이름</td>
                <td><input type="text" id="user_name" name="user_name"/></td>
            </tr>
            <tr>
                <td>휴대폰 번호</td>
                <td><input type="text" id="user_phone_number" name="user_phone_number"/><input type="button"
                                                                                               value="인증번호 발송"
                                                                                               id="btn1"/></td>
            </tr>
            <tr>
                <td></td>
                <td><input type="text" id="phone2"/><input type="button" value="확인" id="btn2"/></td>
            </tr>
        </table>
        <h1 id="hideEmail"></h1>
    </form>
</div>
<script>
    var code2 = "";
    $("#btn1").click(function(){
    var name = document.getElementById('user_name').value;
    var phone = document.getElementById('user_phone_number').value;
        $.ajax({
            type : "post",
            url :"findid",
            data : {
                "user_name" : name,
                "user_phone_number" : phone
            },
            success : function(data){
                if(data == "성공"){
                    alert("인증번호 발송이 완료되었습니다.\n휴대폰에서 인증번호 확인을 해주십시오.");
                    $.ajax({
                        type: "get",
                        url: "phoneCheck",
                        data:{
                        "user_phone_number" : phone,
                        },
                        success:function(data){
                            if(data =="error"){
                                alert("휴대폰 번호가 올바르지 않습니다.")
                            }else{
                                alert("인증번호를 입력해 주세요.")
                                code2 = data;
                                console.log(code2);
                            }
                        }
                    });
                }else{
                    alert("이름과 휴대폰번호가 일치하지 않습니다.")
                }
            },
            error : function(e){
                alert("에러 발생 : " + e);
            }
        })
    })

$("#btn2").click(function(){
    var name = document.getElementById('user_name').value;
    var phone = document.getElementById('user_phone_number').value;
    if($("#phone2").val() == code2 ){
        console.log(name);
        console.log(phone);
        alert("인증번호가 일치합니다.");
        $.ajax({
            type : "post",
            url : "findid2",
            data : {
                "user_name" : name,
                "user_phone_number" : phone,
            },
            success:function(data){
                $("#hideEmail").text(data.user_email);
            },
            error : function(data,e){
                console.log(data);
                alert("에러 발생 : " + e);
            }
        })
    }else{
        alert("인증번호가 일치하지 않습니다.");
    }
})


































































</script>
</body>
</html>